{"version":3,"sources":["webpack:///webpack/bootstrap edd460156c17d1831937","webpack:///external \"mongoose\"","webpack:///./config/index.js","webpack:///external \"jsonwebtoken\"","webpack:///./server/utils/formatTime.js","webpack:///./server/database/models/activity.js","webpack:///./server/database/models/label.js","webpack:///./server/database/models/user.js","webpack:///external \"uuid\"","webpack:///./nuxt.config.js","webpack:///./server/middlewares/database.js","webpack:///./server/middlewares/session.js","webpack:///./server/middlewares/test.js","webpack:///./server/middlewares/verifyToken.js","webpack:///./server/router/routes.js","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-logger\"","webpack:///external \"nuxt\"","webpack:///external \"passport\"","webpack:///./config/password.js","webpack:///./server/api/user.js","webpack:///./server/database/controllers/activity.js","webpack:///./server/database/controllers/article.js","webpack:///./server/database/controllers/label.js","webpack:///./server/database/controllers/user.js","webpack:///./server/database/models/article.js","webpack:///./server/database/models/labelMap.js","webpack:///external \"bcrypt\"","webpack:///external \"koa-router\"","webpack:///external \"koa-session\"","webpack:///./server/index.js"],"names":["secret","api","formatNumber","n","toString","formatTime","date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","map","join","Schema","mongoose","ObjectId","Types","ActivitySchema","log","article_id","String","article_title","operationType","createAt","type","Date","default","now","logLen","Number","pre","next","isNew","console","length","model","LabelSchema","name","color","article","ref","artCount","SALT_WORK_FACTOR","UserSchema","username","token","password","avatar","lockUntil","loginAttempts","required","meta","createdAt","updatedAt","virtual","get","user","isModified","bcrypt","genSalt","error","salt","hash","methods","comparePassword","_password","Promise","resolve","reject","compare","err","isMatch","incLoginAttempts","that","update","$set","$unset","updates","$inc","MAX_LOGIN_ATTEMPTS","isLocked","LOCK_TIME","getToken","jwt","sign","config","expiresIn","module","exports","head","title","charset","content","hid","link","rel","href","css","loading","plugins","build","analyze","vendor","set","connect","db","connection","on","User","findOne","save","addSession","app","keys","CONFIG","key","maxAge","overwrite","signed","rolling","use","session","one","ctx","require","verifyToken","request","headers","verify","decode","body","router","prefix","post","Article","new","list","delete","addLabel","delLabel","Label","allLabels","Activity","all","oneDay","login","logout","message","success","count","query","skipNum","sort","data","ActivityMod","find","skip","parseInt","limit","uuid","v4","description","activity","_id","push","newActivity","e","desc","ArticleMod","populate","path","select","babel","remove","label_id","label","$in","LabelMod","index","indexOf","splice","newLabel","labels","UserMod","match","ArticleSchema","comment","updateAt","LabelMapSchema","host","process","env","HOST","port","PORT","Router","Database","bodyParser","routes","allowedMethods","logger","cors","dev","nuxt","builder","catch","exit","status","res","render","req","promise","then","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 31);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap edd460156c17d1831937","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","export default {\r\n    secret: 'dingjianblog', // used when we create and verify JSON Web Tokens\r\n\tapi: {\r\n        // article\r\n        'addArticleUrl': '/api/article/save',\r\n        'articleListUrl': '/api/article/list',\r\n        'articleUpdateUrl': '/api/article/update',\r\n        'articleDeleteUrl': '/api/article/delete',\r\n        'readArticleUrl': '/api/article/read',\r\n\t\t'addLabelUrl': '/api/article/addLabel',\r\n\t\t'delLabelUrl': '/api/article/delLabel',\r\n\r\n        // activity\r\n        'getAllActivityUrl': '/api/activity/all',\r\n        'getOneDayActivityUrl': '/api/activity/oneDay',\r\n        // user\r\n        'loginUrl': '/api/login',\r\n\t\t\t\t// label\r\n        'newLabelUrl': '/api/label/new',\r\n        'changeLabelUrl': '/api/label/update',\r\n        'getLabelsUrl': '/api/labels',\r\n        'deleteLabelUrl': '/api/label/delete'\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./config/index.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 2\n// module chunks = 0","function formatNumber(n) {\r\n  n = n.toString()\r\n  return n[1] ? n : '0' + n\r\n}\r\nconst formatTime = function (date) {\r\n  var year = date.getFullYear()\r\n  var month = date.getMonth() + 1\r\n  var day = date.getDate()\r\n\r\n  var hour = date.getHours()\r\n  var minute = date.getMinutes()\r\n  var second = date.getSeconds();\r\n\r\n  return [year, month, day].map(formatNumber).join('-')\r\n}\r\n\r\nexport default formatTime\n\n\n// WEBPACK FOOTER //\n// ./server/utils/formatTime.js","import mongoose from 'mongoose'\r\nimport formatTime from '../../utils/formatTime'\r\n\r\nconst Schema = mongoose.Schema\r\nconst ObjectId = Schema.Types.ObjectId\r\n\r\nconst ActivitySchema = new Schema({\r\n    log:[{\r\n        article_id: String,\r\n        article_title: String,\r\n        operationType: String,\r\n        createAt: {\r\n            type: Date,\r\n            default: Date.now()\r\n        }\r\n    }],\r\n    date: String,\r\n    logLen: {\r\n        type: Number,\r\n        default: 0\r\n    }\r\n})\r\n\r\nActivitySchema.pre('save', function(next) {\r\n    if (this.isNew) {\r\n        this.date = formatTime(new Date()) \r\n    }\r\n    console.log(\"logLen:\",this.log.length)\r\n    this.logLen = this.log.length || 0\r\n\r\n    next()\r\n})\r\n\r\nexport default mongoose.model('Activity', ActivitySchema)\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/activity.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\nconst ObjectId = Schema.Types.ObjectId\r\nconst LabelSchema = new Schema({\r\n    name: String,\r\n    color: {\r\n  \t\tdefault: '#000',\r\n  \t\ttype: String\r\n    },\r\n    article: [{\r\n    \ttype: ObjectId,\r\n    \tref: 'Article'\r\n    }],\r\n    artCount: {\r\n    \ttype: Number,\r\n    \tdefault: 0\r\n    }\r\n})\r\n\r\nLabelSchema.pre('save', function(next) {\r\n  this.artCount = this.article.length\r\n  next()\r\n})\r\n\r\nexport default mongoose.model('Label', LabelSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/label.js","import mongoose from 'mongoose'\r\nimport bcrypt from 'bcrypt'\r\nimport jwt from 'jsonwebtoken'\r\nimport config from '../../../config'\r\n\r\nconst SALT_WORK_FACTOR = 10\r\nconst UserSchema = new mongoose.Schema({\r\n    username: String,\r\n    token: String,\r\n    password: String,\r\n    avatar: String,\r\n    lockUntil: Number,\r\n    loginAttempts: {\r\n\t    type: Number,\r\n\t    required: true,\r\n\t    default: 0\r\n\t},\r\n    meta: {\r\n\t    createdAt: {\r\n\t      type: Date,\r\n\t      default: Date.now()\r\n\t    },\r\n\t    updatedAt: {\r\n\t      type: Date,\r\n\t      default: Date.now()\r\n\t    }\r\n\t}\r\n\r\n})\r\n\r\nUserSchema.virtual('isLocked').get(function () {\r\n  \treturn !!(this.lockUntil && this.lockUntil > Date.now())\r\n})\r\n\r\nUserSchema.pre('save', function (next) {\r\n  if (this.isNew) {\r\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\r\n  } else {\r\n    this.meta.updatedAt = Date.now()\r\n  }\r\n\r\n  next()\r\n})\r\n\r\nUserSchema.pre('save', function (next) {\r\n\tlet user = this\r\n\r\n\tif (!user.isModified('password')) return next()\r\n\r\n\tbcrypt.genSalt(SALT_WORK_FACTOR, (error, salt) => {\r\n\t\tif (error) return next(error)\r\n\t\tbcrypt.hash(user.password, salt, (error, hash) => {\r\n\t\t\tif (error) return next(error)\r\n\t\t\t\r\n\t\t\tuser.password = hash\r\n\t\t\tnext()\t\r\n\t\t})\r\n\t})\r\n})\r\n\r\n\r\nUserSchema.methods = {\r\n\tcomparePassword: function (_password, password) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tbcrypt.compare(_password, password, function (err, isMatch) {\r\n\t\t\t\tif (!err) resolve(isMatch)\r\n\t\t\t\telse reject(err)\r\n\t\t\t})\r\n\t\t})\r\n\t},\r\n\tincLoginAttempts: function (user) {\r\n\t    const that = this\r\n\r\n\t    return new Promise((resolve, reject) => {\r\n\t      if (that.lockUntil && that.lockUntil < Date.now()) {\r\n\t        that.update({\r\n\t          $set: {\r\n\t            loginAttempts: 1\r\n\t          }, \r\n\t          $unset: {\r\n\t            lockUntil: 1\r\n\t          }\r\n\t        }, function (err) {\r\n\t          if (!err) resolve(true)\r\n\t          else reject(err)\r\n\t        })\r\n\t      } else {\r\n\t        let updates = {\r\n\t          $inc: {\r\n\t            loginAttempts: 1\r\n\t          }\r\n\t        }\r\n\r\n\t        if (that.loginAttempts + 1 >= MAX_LOGIN_ATTEMPTS && !that.isLocked) {\r\n\t          updates.$set = {\r\n\t            lockUntil: Date.now() + LOCK_TIME\r\n\t          } \r\n\t        }\r\n\r\n\t        that.update(updates, err => {\r\n\t          if (!err) resolve(true)\r\n\t          else reject(err)\r\n\t        })\r\n\t      }\r\n\t    })\r\n  \t},\r\n  \tgetToken: function() {\r\n\t  \tconst token = jwt.sign({name: this.username}, config.secret,{\r\n            expiresIn: 7200\r\n        })\r\n\r\n        return token\r\n  \t}\r\n}\r\n\r\nexport default mongoose.model('User', UserSchema)\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/user.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 7\n// module chunks = 0","module.exports = {\r\n  /*\r\n  ** Headers of the page\r\n  */\r\n  head: {\r\n    title: 'Last Blog',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ]\r\n  },\r\n  /*\r\n  ** Global CSS\r\n  */\r\n  css: [\r\n    './static/less/index.less',\r\n    'element-ui/lib/theme-default/index.css'\r\n  ],\r\n  /*\r\n  ** Customize the progress-bar color\r\n  */\r\n  loading: { color: '#3B8070' },\r\n  plugins: [\r\n    '~plugins/element-ui'\r\n  ],\r\n  build: {\r\n    analyze: false,\r\n    vendor: ['element-ui']\r\n  },\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import mongoose from 'mongoose'\r\nimport config from '../../config'\r\nimport password from '../../config/password'\r\nimport User from '../database/models/user'\r\n\r\n\r\nexport default () => {\r\n    mongoose.set('debug', true)\r\n\r\n    mongoose.connect(password.db)\r\n\r\n    mongoose.connection.on('disconnected', () => {\r\n        mongoose.connect(password.db)\r\n    })\r\n    mongoose.connection.on('error', err => {\r\n        console.log(err)\r\n    })\r\n\r\n    mongoose.connection.on('open', async ()=> {\r\n        console.log('Connected to MongoDB Success')\r\n\r\n        let user = await User.findOne({username: password.user.username})\r\n\r\n        if (!user) {\r\n            new User(password.user).save()\r\n            console.log(\"写入管理员数据\")\r\n        }\r\n    })\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/database.js","import session from 'koa-session'\r\nconst addSession = app => {\r\n  app.keys = ['ice']\r\n\r\n  const CONFIG = {\r\n    key: 'koa:sess',\r\n    maxAge: 86400000,\r\n    overwrite: true,\r\n    signed: true,\r\n    rolling: false\r\n  }\r\n  app.use(session(CONFIG, app))\r\n}\r\n\r\nexport default addSession\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/session.js","const one = (ctx, next) => {\r\n  console.log('>> one');\r\n  // next();\r\n  console.log('<< one');\r\n}\r\n\r\nexport default one\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/test.js","const jwt = require('jsonwebtoken')\r\nconst config = require('../../config')\r\n\r\nconst verifyToken = (ctx,next) => {\r\n\tconst token = ctx.request.headers[\"x-access-token\"] // 从body或query或者header中获取token\r\n\tjwt.verify(token, config.secret, (err, decode) => {\r\n        if (err) {  //  时间失效的时候/ 伪造的token          \r\n           ctx.body={err:err}\r\n        } else {\r\n            // rq.decode = decode; \r\n            console.log(decode.name);   // today  is  a  good  day\r\n            next();\r\n        }\r\n    })\r\n}\r\nexport default verifyToken\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/verifyToken.js","import Router from 'koa-router'\r\nimport Article from '../database/controllers/article'\r\nimport Label from '../database/controllers/label'\r\nimport Activity from '../database/controllers/activity'\r\nimport User from '../database/controllers/user'\r\nimport { verifyToken } from '../api/user'\r\n\r\nexport default () => {\r\n\tconst router = new Router({ prefix: '/api' })\r\n\r\n    // article\r\n\trouter.post('/article/save', verifyToken, Article.new)\r\n    router.get('/article/list', Article.list)\r\n    router.post('/article/update',verifyToken, Article.update)\r\n    router.post('/article/delete',verifyToken, Article.delete)\r\n    router.get('/article/read', Article.findOne)\r\n    router.post('/article/addLabel',verifyToken, Article.addLabel)\r\n\trouter.post('/article/delLabel',verifyToken, Article.delLabel)\r\n    // label\r\n    router.get('/labels', Label.allLabels)\r\n    router.post('/label/new',verifyToken, Label.new)\r\n    router.post('/label/update',verifyToken, Label.update)\r\n    router.post('/label/delete',verifyToken, Label.delete)\r\n\r\n    // activity\r\n    router.get('/activity/all', Activity.all)\r\n    router.get('/activity/oneday', Activity.oneDay)\r\n\r\n    // user\r\n    router.post('/login', User.login)\r\n    router.post('/logout', verifyToken, User.logout)\r\n\r\n\treturn router\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/router/routes.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"koa-logger\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-logger\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"passport\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"passport\"\n// module id = 19\n// module chunks = 0","export default {\r\n    db: 'mongodb://blog_runner:ding15155620677@59.110.164.55:27017/blog',\r\n    user: {\r\n    \tusername: '2902273280@qq.com',\r\n        password: 'ding15155620677',\r\n        avatar: 'http://ovs5x36k4.bkt.clouddn.com/06.jpg'\r\n    },\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./config/password.js","import jwt from 'jsonwebtoken'\r\nimport config from '../../config'\r\n\r\nexport const verifyToken = (ctx, next) => {\r\n    return new Promise(function(resolve, reject) {\r\n        const token = ctx.request.headers[\"x-access-token\"] // 从body或query或者header中获取token\r\n        console.log(\"获取签名\",token)\r\n        jwt.verify(token, config.secret, (err, decode) => {\r\n            if (err) {  //  时间失效/伪造token\r\n                console.log(err.message)  \r\n                ctx.body={\r\n                    success: false,\r\n                    message: err.message\r\n                }\r\n            } else {\r\n                console.log(decode.name)\r\n                resolve(next())\r\n            }\r\n        })\r\n    });\r\n\t\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/user.js","import mongoose from 'mongoose'\r\nimport ActivityMod from '../models/activity.js'\r\n\r\nclass Activity {\r\n    constructor() {}\r\n\r\n    async all(ctx) {\r\n    \tconst count = ctx.request.query.count || 360\r\n        const skipNum = ctx.request.query.skipNum || 0\r\n        const sort = ctx.request.query.sort || -1\r\n\r\n        const data = await ActivityMod.find({},'date logLen').sort({'date': sort})\r\n        .skip(parseInt(skipNum)).limit(parseInt(count))\r\n\r\n        ctx.body = {\r\n            message: 'success',\r\n            data: data\r\n        }\r\n    }\r\n    // 一天的操作记录\r\n    async oneDay(ctx) {\r\n    \tconst date = ctx.request.query.date\r\n    \tconst sort = ctx.request.query.sort || -1\r\n\r\n    \tconst data = await ActivityMod.find({date: date}).sort({'date': sort})\r\n    }\r\n}\r\n\r\nexport default new Activity()\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/activity.js","import mongoose from 'mongoose'\r\nimport ArticleMod from '../models/article'\r\nimport ActivityMod from '../models/activity'\r\nimport uuid from 'uuid'\r\nimport formatTime from '../../utils/formatTime'\r\nimport LabelMapMod from '../models/labelMap'\r\nimport LabelMod from '../models/label'\r\n\r\nclass Article {\r\n    constructor() {}\r\n\r\n    async new(ctx) {\r\n        const key = uuid.v4()\r\n        const {title, content, description} = ctx.request.body\r\n        let article\r\n\r\n        try {\r\n            article = new ArticleMod({\r\n                title: title,\r\n                content: content,\r\n                description: description\r\n            })\r\n            article = await article.save()\r\n\r\n            const date = formatTime(new Date())\r\n            let activity = await ActivityMod.findOne({date: date})\r\n\r\n            if (activity) {\r\n                const log = {\r\n                    article_id: article._id,\r\n                    article_title: article.title,\r\n                    operationType: 'created'\r\n                }\r\n\r\n                activity.log.push(log)\r\n                await activity.save()\r\n            }else {\r\n                let newActivity = new ActivityMod({\r\n                    log: [{\r\n                        article_id: article._id,\r\n                        article_title: article.title,\r\n                        operationType: 'created'\r\n                    }]\r\n                })\r\n                await newActivity.save()\r\n            }\r\n\r\n        }catch(e) {\r\n            ctx.body = {\r\n                message: '保存失败',\r\n            }\r\n        }\r\n\r\n        ctx.body = {\r\n            success: 'true',\r\n            message: '保存成功',\r\n            data: {\r\n                _id: article._id,\r\n                title: article.title,\r\n                desc: article.description\r\n            }\r\n        }\r\n    }\r\n\r\n    async list(ctx) {\r\n        const count = ctx.request.query.count || 100\r\n        const skipNum = ctx.request.query.skipNum || 0\r\n        const sort = ctx.request.query.sort || -1\r\n\r\n        const data = await ArticleMod.find({},['title', 'description', 'meta', 'label'])\r\n            .populate({ path: 'label', select: 'name color artCount' })\r\n            .sort({'meta.updateAt': sort})\r\n            .skip(parseInt(skipNum))\r\n            .limit(parseInt(count))\r\n\r\n        ctx.body = {\r\n            message: 'success',\r\n            data: data\r\n        }\r\n    }\r\n\r\n    async update(ctx) {\r\n\r\n        const {content, description, title, _id, babel} = ctx.request.body\r\n\r\n        let article = await ArticleMod.findOne({_id:_id})\r\n        if(title && content && description) {\r\n          article.title = title\r\n          article.content = content\r\n          article.description = description\r\n          await article.save()\r\n        }\r\n        // 保存操作日志\r\n        try {\r\n            const date = formatTime(new Date())\r\n            let activity = await ActivityMod.findOne({date: date})\r\n\r\n            if (activity) {\r\n                console.log(\"当天有日志\")\r\n                const log = {\r\n                    article_id: article._id,\r\n                    article_title: article.title,\r\n                    operationType: 'updated'\r\n                }\r\n                activity.log.push(log)\r\n                await activity.save()\r\n            }else {\r\n                console.log(\"当天没有日志\")\r\n                const newActivity = new ActivityMod({\r\n                    log:[{\r\n                        article_id: article._id,\r\n                        article_title: article.title,\r\n                        operationType: 'updated'\r\n                    }]\r\n                })\r\n                await newActivity.save()\r\n            }\r\n\r\n        }catch(e) {\r\n            ctx.body = {\r\n                message: '更新失败',\r\n            }\r\n        }\r\n\r\n        ctx.body = {\r\n            message: '保存成功',\r\n            data: article\r\n        }\r\n    }\r\n\r\n    async delete(ctx) {\r\n        const _id = ctx.request.body._id\r\n        try {\r\n            // 保存日志\r\n            const article = await ArticleMod.findOne({_id: _id})\r\n            const date = formatTime(new Date())\r\n            let activity = await ActivityMod.findOne({date: date})\r\n\r\n            if (activity) {\r\n                const log = {\r\n                    article_id: article._id,\r\n                    article_title: article.title,\r\n                    operationType: 'deleted'\r\n                }\r\n                activity.log.push(log)\r\n                await activity.save()\r\n            }else {\r\n                const newActivity = new ActivityMod({\r\n                    article_id: article._id,\r\n                    article_title: article.title,\r\n                    operationType: 'deleted'\r\n                })\r\n                await newActivity.save()\r\n            }\r\n            // 删除文章\r\n            await ArticleMod.remove({_id: _id})\r\n        }catch(e) {\r\n            ctx.body = {\r\n                message: 'failed'\r\n            }\r\n        }\r\n\r\n        ctx.body = {\r\n            message: 'success'\r\n        }\r\n    }\r\n\r\n    async findOne(ctx) {\r\n        const _id = ctx.request.query._id\r\n\r\n        if (_id) {\r\n            const data = await ArticleMod.findOne({_id:_id})\r\n               .populate({ path: 'label', select: 'name color artCount' })\r\n            ctx.body = {\r\n                message: 'success',\r\n                data: data\r\n            }\r\n        }\r\n    }\r\n\r\n    async addLabel(ctx) {\r\n        const {label_id, article_id} = ctx.request.body\r\n        let article = await ArticleMod.findOne({_id: article_id, label: {$in: [label_id]}})\r\n        if (article) {\r\n            ctx.body = {\r\n                success: false,\r\n                message: '该标签已存在'\r\n            }\r\n            return\r\n        }\r\n\r\n        article = await ArticleMod.findOne({_id: article_id})\r\n        let label = await LabelMod.findOne({_id: label_id})\r\n\r\n        article.label.push(label)\r\n        label.article.push(article)\r\n        article = await article.save()\r\n        label = await label.save()\r\n\r\n        ctx.body = {\r\n            success: true,\r\n            message: '添加标签成功',\r\n            data: article.label\r\n        }\r\n    }\r\n\r\n    async delLabel(ctx) {\r\n      const {article_id, label_id} = ctx.request.body\r\n      let article =await ArticleMod.findOne({_id: article_id})\r\n\r\n      console.log(article.label)\r\n      const index = article.label.indexOf(label_id)\r\n      article.label.splice(index,1)\r\n\r\n      article = await article.save()\r\n\r\n      ctx.body = {\r\n        success: true,\r\n        data: article.label\r\n      }\r\n    }\r\n}\r\n\r\nexport default new Article()\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/article.js","import mongoose from 'mongoose'\r\n\r\nimport LabelMod from '../models/label'\r\n\r\nclass Label {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    async new( ctx ) {\r\n        const {name,color} = ctx.request.body\r\n        let label = await LabelMod.findOne({name: name})\r\n\r\n        if (!label) {\r\n            const newLabel = await new LabelMod({name: name, color: color}).save()\r\n            ctx.body = {\r\n                success: true,\r\n                message: \"添加Label成功\",\r\n                data: newLabel\r\n            }\r\n\r\n            return\r\n        }\r\n\r\n        ctx.body = {\r\n            success: false,\r\n            message: 'Label已存在',\r\n        }\r\n\r\n    }\r\n\r\n    async delete(ctx) {\r\n        const _id = ctx.request.body._id\r\n\r\n        try {\r\n            await LabelMod.remove({_id:_id})\r\n        }catch(e){\r\n            ctx.body = {\r\n                success: false,\r\n                message: e,\r\n            }\r\n        }\r\n\r\n        ctx.body = {\r\n            success: true,\r\n            message: '删除成功'\r\n        }\r\n    }\r\n\r\n    async allLabels(ctx) {\r\n        const {limit=100, skip=0, sort=-1} = ctx.request.query\r\n        let labels = await LabelMod.find({},['name', 'color', 'artCount'])\r\n                .populate({ path: 'article',select: 'title description label meta',populate: {path: 'label'} })\r\n                .limit(parseInt(limit))\r\n                .skip(parseInt(skip))\r\n                .sort({'artCount': sort})\r\n\r\n        ctx.body = {\r\n            success: true,\r\n            data: labels\r\n        }\r\n    }\r\n\r\n    async update(ctx) {\r\n        const {name,color,_id} = ctx.request.body\r\n\r\n        let label = await LabelMod.findOne({_id:_id})\r\n        label.name = name\r\n        label.color = color\r\n        label = await label.save()\r\n\r\n        ctx.body = {\r\n            success: true,\r\n            message: '修盖label成功',\r\n            data: label\r\n        }\r\n\r\n    }\r\n\r\n    // async getLabelArts(ctx) {\r\n    //     const _id = ctx.request.query._id\r\n    //     let label = await LabelMod.findOne({_id:_id})\r\n\r\n    // }\r\n}\r\n\r\nexport default new Label()\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/label.js","import mongoose from 'mongoose'\r\nimport UserMod from '../models/user'\r\nimport jwt from 'jsonwebtoken'\r\nimport config from '../../../config'\r\nimport uuid from 'uuid'\r\n\r\nclass User {\r\n    constructor() {}\r\n\r\n    async login(ctx) {\r\n        const {username, password} = ctx.request.body\r\n        const user = await UserMod.findOne({ username: username })\r\n\r\n        let match = false\r\n        if (user) match = await user.comparePassword(password, user.password)\r\n        if (match) {\r\n            ctx.session.user = {\r\n                username: user.username,\r\n                _id: user._id\r\n            }\r\n            \r\n            const token = user.getToken()\r\n            user.token = token\r\n            await user.save()\r\n\r\n            return (ctx.body = {\r\n                success: true,\r\n                data: {\r\n                    username: user.username,\r\n                    token: token\r\n                }\r\n            })\r\n        }\r\n\r\n        return (ctx.body = {\r\n            success: false,\r\n            message: '密码错误'\r\n        })\r\n    }\r\n\r\n    async logout(ctx) {\r\n        ctx.body = {\r\n            success: true,\r\n            message: \"登出\"\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport default new User()\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/user.js","import mongoose from 'mongoose'\r\nimport formatTime from '../../utils/formatTime'\r\n\r\nconst Schema = mongoose.Schema\r\nconst ObjectId = Schema.Types.ObjectId\r\n\r\nconst ArticleSchema = new Schema({\r\n    title: String,\r\n    content: String,\r\n    comment: String,\r\n    description: String,\r\n    label: [{\r\n      type: ObjectId,\r\n      ref: 'Label'\r\n    }],\r\n    meta: {\r\n      createAt: {\r\n        type: Date,\r\n        default: Date.now()\r\n      },\r\n      updateAt: {\r\n        type: Date,\r\n        default: Date.now()\r\n      }\r\n    }\r\n})\r\n\r\nArticleSchema.pre('save', function(next) {\r\n  if (this.isNew) {\r\n    this.meta.createAt = this.meta.updateAt = new Date()\r\n    console.log(\"创建时间\",this.meta.createAt)\r\n  }else {\r\n    this.meta.updateAt = new Date()\r\n  }\r\n\r\n  next()\r\n})\r\n\r\nexport default mongoose.model('Article', ArticleSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/article.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\nconst ObjectId = Schema.Types.ObjectId\r\n\r\nconst LabelMapSchema = new Schema({\r\n    label: {\r\n    \ttype: ObjectId,\r\n    \tref: 'Label'\r\n    },\r\n    article: {\r\n    \ttype: ObjectId,\r\n    \tref: 'Article'\r\n    }\r\n})\r\n\r\nexport default mongoose.model('LabelMap', LabelMapSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/labelMap.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 30\n// module chunks = 0","import Koa from 'koa'\r\nimport { Nuxt, Builder } from 'nuxt'\r\nimport Router from './router/routes'\r\nimport mongoose from 'mongoose'\r\nimport logger from 'koa-logger'\r\n\r\nimport bodyParser from 'koa-bodyparser'\r\nimport passport from 'passport'\r\nimport cors from 'koa-cors'\r\nimport Database from './middlewares/database'\r\nimport VerifyToken from './middlewares/verifyToken'\r\nimport one from './middlewares/test'\r\nimport addSession from './middlewares/session'\r\n\r\nconst app = new Koa()\r\nconst host = process.env.HOST || '127.0.0.1'\r\nconst port = process.env.PORT || 3000\r\nconst router = Router()\r\n\r\n// 数据库\r\nDatabase()\r\n\r\napp.use(bodyParser())\r\napp.use(router.routes())\r\napp.use(router.allowedMethods())\r\napp.use(logger())\r\napp.use(cors())\r\naddSession(app)\r\n\r\n// Import and Set Nuxt.js options\r\nlet config = require('../nuxt.config.js')\r\nconfig.dev = !(app.env === 'production')\r\n\r\n// Instantiate nuxt.js\r\nconst nuxt = new Nuxt(config)\r\n\r\n// Build in development\r\nif (config.dev) {\r\n  const builder = new Builder(nuxt)\r\n  builder.build().catch(e => {\r\n    console.error(e) // eslint-disable-line no-console\r\n    process.exit(1)\r\n  })\r\n}\r\n\r\napp.use(ctx => {\r\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\r\n\r\n  return new Promise((resolve, reject) => {\r\n    ctx.res.on('close', resolve)\r\n    ctx.res.on('finish', resolve)\r\n    nuxt.render(ctx.req, ctx.res, promise => {\r\n      // nuxt.render passes a rejected promise into callback on error.\r\n      promise.then(resolve).catch(reject)\r\n    })\r\n  })\r\n})\r\n\r\n\r\napp.listen(port, host)\r\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}