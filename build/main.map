{"version":3,"sources":["webpack:///webpack/bootstrap 0541a8ec5ce683e2f214","webpack:///external \"mongoose\"","webpack:///./server/utils/formatTime.js","webpack:///./server/database/models/activity.js","webpack:///./server/database/models/user.js","webpack:///external \"uuid\"","webpack:///./nuxt.config.js","webpack:///./server/middlewares/database.js","webpack:///./server/router/routes.js","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-cors\"","webpack:///external \"koa-logger\"","webpack:///external \"koa-session\"","webpack:///external \"nuxt\"","webpack:///./config/index.js","webpack:///./server/database/controllers/activity.js","webpack:///./server/database/controllers/article.js","webpack:///./server/database/controllers/label.js","webpack:///./server/database/controllers/user.js","webpack:///./server/database/models/article.js","webpack:///./server/database/models/label.js","webpack:///external \"bcrypt\"","webpack:///external \"koa-router\"","webpack:///./server/index.js"],"names":["formatNumber","n","toString","formatTime","date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","second","getSeconds","map","join","Schema","mongoose","ObjectId","Types","ActivitySchema","log","article_id","String","article_title","operationType","createAt","type","Date","default","now","logLen","Number","pre","next","isNew","console","length","model","SALT_WORK_FACTOR","UserSchema","username","token","password","avatar","lockUntil","loginAttempts","required","meta","createdAt","updatedAt","virtual","get","user","isModified","bcrypt","genSalt","error","salt","hash","methods","comparePassword","_password","Promise","resolve","reject","compare","err","isMatch","incLoginAttempts","that","update","$set","$unset","updates","$inc","MAX_LOGIN_ATTEMPTS","isLocked","LOCK_TIME","module","exports","head","title","charset","name","content","hid","link","rel","href","css","loading","color","plugins","build","analyze","vendor","set","connect","config","db","connection","on","User","findOne","save","router","prefix","post","Article","add","list","delete","Activity","all","oneDay","login","api","ctx","count","request","query","skipNum","sort","data","ActivityMod","find","skip","parseInt","limit","body","message","key","uuid","v4","description","babel","split","article","activity","_id","push","newActivity","e","success","desc","ArticleMod","remove","Label","label","LabelMod","newLabel","BabelMod","labels","UserMod","match","session","ArticleSchema","comment","updateAt","LabelSchema","artCount","app","host","process","env","HOST","port","PORT","Router","use","bodyParser","routes","allowedMethods","logger","cors","maxAge","overwrite","signed","rolling","Database","require","dev","nuxt","builder","catch","exit","status","res","render","req","promise","then","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 23);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0541a8ec5ce683e2f214","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","function formatNumber(n) {\n  n = n.toString()\n  return n[1] ? n : '0' + n\n}\nconst formatTime = function (date) {\n  var year = date.getFullYear()\n  var month = date.getMonth() + 1\n  var day = date.getDate()\n\n  var hour = date.getHours()\n  var minute = date.getMinutes()\n  var second = date.getSeconds();\n\n  return [year, month, day].map(formatNumber).join('-')\n}\n\nexport default formatTime\n\n\n// WEBPACK FOOTER //\n// ./server/utils/formatTime.js","import mongoose from 'mongoose'\nimport formatTime from '../../utils/formatTime'\n\nconst Schema = mongoose.Schema\nconst ObjectId = Schema.Types.ObjectId\n\nconst ActivitySchema = new Schema({\n    log:[{\n        article_id: String,\n        article_title: String,\n        operationType: String,\n        createAt: {\n            type: Date,\n            default: Date.now()\n        }\n    }],\n    date: String,\n    logLen: {\n        type: Number,\n        default: 0\n    }\n})\n\nActivitySchema.pre('save', function(next) {\n    if (this.isNew) {\n        this.date = formatTime(new Date()) \n    }\n    console.log(\"logLen:\",this.log.length)\n    this.logLen = this.log.length || 0\n\n    next()\n})\n\nexport default mongoose.model('Activity', ActivitySchema)\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/activity.js","import mongoose from 'mongoose'\nimport bcrypt from 'bcrypt'\n\nconst SALT_WORK_FACTOR = 10\nconst UserSchema = new mongoose.Schema({\n    username: String,\n    token: String,\n    password: String,\n    avatar: String,\n    lockUntil: Number,\n    loginAttempts: {\n\t    type: Number,\n\t    required: true,\n\t    default: 0\n\t},\n    meta: {\n\t    createdAt: {\n\t      type: Date,\n\t      default: Date.now()\n\t    },\n\t    updatedAt: {\n\t      type: Date,\n\t      default: Date.now()\n\t    }\n\t }\n\n})\n\nUserSchema.virtual('isLocked').get(function () {\n  \treturn !!(this.lockUntil && this.lockUntil > Date.now())\n})\n\nUserSchema.pre('save', function (next) {\n  if (this.isNew) {\n    this.meta.createdAt = this.meta.updatedAt = Date.now()\n  } else {\n    this.meta.updatedAt = Date.now()\n  }\n\n  next()\n})\n\nUserSchema.pre('save', function (next) {\n\tlet user = this\n\n\tif (!user.isModified('password')) return next()\n\n\tbcrypt.genSalt(SALT_WORK_FACTOR, (error, salt) => {\n\t\tif (error) return next(error)\n\t\tbcrypt.hash(user.password, salt, (error, hash) => {\n\t\t\tif (error) return next(error)\n\n\t\t\tuser.password = hash\n\t\t\tnext()\t\n\t\t})\n\t})\n})\n\nUserSchema.methods = {\n\tcomparePassword: function (_password, password) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tbcrypt.compare(_password, password, function (err, isMatch) {\n\t\t\t\tif (!err) resolve(isMatch)\n\t\t\t\telse reject(err)\n\t\t\t})\n\t\t})\n\t},\n\tincLoginAttempts: function (user) {\n\t    const that = this\n\n\t    return new Promise((resolve, reject) => {\n\t      if (that.lockUntil && that.lockUntil < Date.now()) {\n\t        that.update({\n\t          $set: {\n\t            loginAttempts: 1\n\t          }, \n\t          $unset: {\n\t            lockUntil: 1\n\t          }\n\t        }, function (err) {\n\t          if (!err) resolve(true)\n\t          else reject(err)\n\t        })\n\t      } else {\n\t        let updates = {\n\t          $inc: {\n\t            loginAttempts: 1\n\t          }\n\t        }\n\n\t        if (that.loginAttempts + 1 >= MAX_LOGIN_ATTEMPTS && !that.isLocked) {\n\t          updates.$set = {\n\t            lockUntil: Date.now() + LOCK_TIME\n\t          } \n\t        }\n\n\t        that.update(updates, err => {\n\t          if (!err) resolve(true)\n\t          else reject(err)\n\t        })\n\t      }\n\t    })\n  \t}\n}\n\nexport default mongoose.model('User', UserSchema)\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/user.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 4\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'Last Blog',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n    './static/less/index.less',\n    'element-ui/lib/theme-default/index.css'\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  plugins: [\n    '~plugins/element-ui'\n  ],\n  build: {\n    analyze: false,\n    vendor: ['element-ui']\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import mongoose from 'mongoose'\nimport config from '../../config'\nimport User from '../database/models/user'\n\n\nexport default () => {\n    mongoose.set('debug', true)\n\n    mongoose.connect(config.db)\n\n    mongoose.connection.on('disconnected', () => {\n        mongoose.connect(config.db)\n    })\n    mongoose.connection.on('error', err => {\n        console.log(err)\n    })\n\n    mongoose.connection.on('open', async ()=> {\n        console.log('Connected to MongoDB Success')\n\n        let user = await User.findOne({username: config.user.username})\n\n        if (!user) {\n            new User(config.user).save()\n            console.log(\"写入管理员数据\")\n        }\n    })\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/database.js","import Router from 'koa-router'\nimport Article from '../database/controllers/article'\nimport Label from '../database/controllers/label'\nimport Activity from '../database/controllers/activity'\nimport User from '../database/controllers/user'\n\nexport default () => {\n\tconst router = new Router({ prefix: '/api' })\n\n    // article\n\trouter.post('/article/save', Article.add)\n    router.get('/article/list', Article.list)\n    router.post('/article/update', Article.update)\n    router.post('/article/delete', Article.delete)\n    router.get('/article/read', Article.findOne)\n\n    // label\n    // router.get('/label/list', Babel.list)\n    // router.post('/label/add', Babel.add)\n    // router.post('/label/delete', Babel.delete)\n\n    // activity\n    router.get('/activity/all', Activity.all)\n    router.get('/activity/oneday', Activity.oneDay)\n\n    // user\n    // router.post('/user/register', User.register)\n    router.post('/login', User.login)\n\n\treturn router\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/router/routes.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa-cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-cors\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"koa-logger\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-logger\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 13\n// module chunks = 0","export default {\n\tdb: 'mongodb://blog_runner:dj15155620677@59.110.164.55:27017/blog',\n    user: {\n        username: '2902273280@qq.com',\n        password: '2902273280',\n    },\n\tapi: {\n        // article\n        'addArticleUrl': '/api/article/save',\n        'articleListUrl': '/api/article/list',\n        'articleUpdateUrl': '/api/article/update',\n        'articleDeleteUrl': '/api/article/delete',\n        'readArticleUrl': '/api/article/read',\n\n        // activity\n        'getAllActivityUrl': '/api/activity/all',\n        'getOneDayActivityUrl': '/api/activity/oneDay',\n        // user\n        'loginUrl': '/api/login'\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./config/index.js","import mongoose from 'mongoose'\nimport ActivityMod from '../models/activity.js'\n\nclass Activity {\n    constructor() {}\n\n    async all(ctx) {\n    \tconst count = ctx.request.query.count || 360\n        const skipNum = ctx.request.query.skipNum || 0\n        const sort = ctx.request.query.sort || -1\n\n        const data = await ActivityMod.find({},'date logLen').sort({'date': sort})\n        .skip(parseInt(skipNum)).limit(parseInt(count))\n\n        ctx.body = {\n            message: 'success',\n            data: data\n        }\n    }\n    // 一天的操作记录\n    async oneDay(ctx) {\n    \tconst date = ctx.request.query.date\n    \tconst sort = ctx.request.query.sort || -1\n\n    \tconst data = await ActivityMod.find({date: date}).sort({'date': sort})\n    }\n}\n\nexport default new Activity()\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/activity.js","import mongoose from 'mongoose'\nimport ArticleMod from '../models/article'\nimport ActivityMod from '../models/activity'\nimport uuid from 'uuid'\nimport formatTime from '../../utils/formatTime'\n\nclass Article {\n    constructor() {}\n\n    async add(ctx) {\n        const key = uuid.v4()\n        const {title, content, description} = ctx.request.body\n        const babel  = ctx.request.body.babel.split(',')\n        let article\n\n        try {\n            article = new ArticleMod({\n                title: title,\n                content: content,\n                babel: babel,\n                description: description\n            })\n            article = await article.save()\n\n            const date = formatTime(new Date())\n            let activity = await ActivityMod.findOne({date: date})\n\n            if (activity) {\n                const log = {\n                    article_id: article._id,\n                    article_title: article.title,\n                    operationType: 'created'\n                }\n\n                activity.log.push(log)\n                await activity.save()\n            }else {\n                let newActivity = new ActivityMod({\n                    log: [{\n                        article_id: article._id,\n                        article_title: article.title,\n                        operationType: 'created'\n                    }]\n                })\n                await newActivity.save()\n            }\n\n        }catch(e) {\n            ctx.body = {\n                message: '保存失败',\n            }\n        }\n\n        ctx.body = {\n            success: 'true',\n            message: '保存成功',\n            data: {\n                _id: article._id, \n                title: article.title, \n                desc: article.description\n            }\n        }\n    }\n\n    async list(ctx) {\n        const count = ctx.request.query.count || 10\n        const skipNum = ctx.request.query.skipNum || 0\n        const sort = ctx.request.query.sort || -1\n\n        const data = await ArticleMod.find({},['title', 'description', 'babel', 'meta', 'comment']).sort({'meta.updateAt': sort}).skip(parseInt(skipNum)).limit(parseInt(count))\n\n        ctx.body = {\n            message: 'success',\n            data: data\n        }\n    }\n\n    async update(ctx) {\n        \n        const {content, description, title, _id, babel} = ctx.request.body\n\n        let article = await ArticleMod.findOne({_id:_id})\n        if(title && content && description) {\n          article.title = title\n          article.content = content\n          article.description = description\n          await article.save()\n        }\n        // 保存操作日志\n        try {\n            const date = formatTime(new Date())\n            let activity = await ActivityMod.findOne({date: date})\n\n            if (activity) {\n                console.log(\"当天有日志\")\n                const log = {\n                    article_id: article._id,\n                    article_title: article.title,\n                    operationType: 'updated'\n                }\n                activity.log.push(log)\n                await activity.save()\n            }else {\n                console.log(\"当天没有日志\")\n                const newActivity = new ActivityMod({\n                    log:[{\n                        article_id: article._id,\n                        article_title: article.title,\n                        operationType: 'updated'\n                    }]\n                })\n                await newActivity.save()\n            }\n\n        }catch(e) {\n            ctx.body = {\n                message: '更新失败',\n            }\n        }\n\n        ctx.body = {\n            message: '保存成功',\n            data: article\n        }\n    }\n\n    async delete(ctx) {\n        const _id = ctx.request.body._id\n        try {\n            // 保存日志\n            const article = await ArticleMod.findOne({_id: _id})\n            const date = formatTime(new Date())\n            let activity = await ActivityMod.findOne({date: date})\n\n            if (activity) {\n                const log = {\n                    article_id: article._id,\n                    article_title: article.title,\n                    operationType: 'deleted'\n                }\n                activity.log.push(log)\n                await activity.save()\n            }else {\n                const newActivity = new ActivityMod({\n                    article_id: article._id,\n                    article_title: article.title,\n                    operationType: 'deleted'\n                })\n                await newActivity.save()\n            }\n            // 删除文章\n            await ArticleMod.remove({_id: _id})\n        }catch(e) {\n            ctx.body = {\n                message: 'failed'\n            }\n        }\n\n        ctx.body = {\n            message: 'success'\n        }\n    }\n\n    async findOne(ctx) {\n        const _id = ctx.request.query._id\n\n        if (_id) {\n            const data = await ArticleMod.findOne({_id:_id})\n\n            ctx.body = {\n                message: 'success',\n                data: data\n            }\n        }\n    }\n\n}\n\nexport default new Article()\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/article.js","import mongoose from 'mongoose'\n\nimport LabelMod from '../models/label'\n\nclass Label {\n    constructor() {\n\n    }\n\n    async new( ctx ) {\n        const {name,color} = ctx.request.body\n        let label = await LabelMod.findOne({name: name,color: color})\n\n        if (!label) {\n            const newLabel = await new LabelMod({name:name}).save()\n            ctx.body = {\n                success: true,\n                message: \"添加Label成功\",\n                data: newLabel\n            }\n        }else {\n            ctx.body = {\n                success: false,\n                message: 'Label已存在',\n            }\n        }\n    }\n\n    async delete(ctx) {\n        const _id = ctx.request.body._id\n\n        try {\n            await BabelMod.remove({_id:_id})\n        }catch(e){\n            ctx.body = {\n                success: false,\n                message: e,\n            }\n        }\n        \n        ctx.body = {\n            success: true,\n            message: '删除成功'\n        }\n    }\n\n    async allLabels(ctx) {\n        let labels\n        try{\n            labels = await LabelMod.find({})\n        }catch(e) {\n            ctx.body = {\n                success: false,\n                message: '获取失败',\n                data: e\n            }\n        }\n        ctx.body = {\n            success: true,\n            data: labels\n        }\n    }\n}\n\nexport default new Label()\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/label.js","import mongoose from 'mongoose'\nimport UserMod from '../models/user'\nimport uuid from 'uuid'\n\nclass User {\n    constructor() {}\n\n    async login(ctx) {\n        const {username, password} = ctx.request.body\n        const user = await UserMod.findOne({ username: username })\n\n        let match = false\n        if (user) match = await user.comparePassword(password, user.password)\n        if (match) {\n            ctx.session.user = {\n                username: user.username,\n                _id: user._id\n            }\n\n            return (ctx.body = {\n                success: true,\n                data: {\n                    username: user.username\n                }\n            })\n        }\n\n        return (ctx.body = {\n            success: false,\n            message: '密码错误'\n        })\n\n        \n    }\n}\n\nexport default new User()\n\n\n// WEBPACK FOOTER //\n// ./server/database/controllers/user.js","import mongoose from 'mongoose'\nimport formatTime from '../../utils/formatTime'\n\nconst Schema = mongoose.Schema\nconst ObjectId = Schema.Types.ObjectId\n\nconst ArticleSchema = new Schema({\n    title: String,\n    babel: [String],\n    content: String,\n    comment: String,\n    description: String,\n    meta: {\n      createAt: String,\n      updateAt: {\n        type: Date,\n        default: Date.now()\n      }\n    }\n})\n\nArticleSchema.pre('save', function(next) {\n  if (this.isNew) {\n    this.meta.createAt = this.meta.updateAt = new Date()\n    console.log(\"创建时间\",this.meta.createAt)\n  }else {\n    this.meta.updateAt = new Date()\n  }\n\n  next()\n})\n\nexport default mongoose.model('Article', ArticleSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/article.js","import mongoose from 'mongoose'\nconst Schema = mongoose.Schema\n\nconst LabelSchema = new Schema({\n    name: String,\n    color: {\n\t\tdefault: '#000',\n\t\ttype: String\n    },\n    artCount: {\n    \tdefault: 0,\n    \ttype: Number\n    },\n})\n\nexport default mongoose.model('Label', LabelSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/models/label.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 22\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport Router from './router/routes'\nimport mongoose from 'mongoose'\nimport logger from 'koa-logger'\nimport session from 'koa-session'\nimport bodyParser from 'koa-bodyparser'\nimport cors from 'koa-cors'\nimport Database from './middlewares/database'\n\nconst app = new Koa()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\nconst router = Router()\n\n\napp.use(bodyParser())\napp.use(router.routes())\napp.use(router.allowedMethods())\napp.use(logger())\napp.use(cors())\napp.use(session({\n  key: 'koa:sess',\n  maxAge: 86400000,\n  overwrite: true,\n  signed: true,\n  rolling: false\n},app))\n\n// 数据库\nDatabase()\n// Import and Set Nuxt.js options\nlet config = require('../nuxt.config.js')\nconfig.dev = !(app.env === 'production')\n\n// Instantiate nuxt.js\nconst nuxt = new Nuxt(config)\n\n// Build in development\nif (config.dev) {\n  const builder = new Builder(nuxt)\n  builder.build().catch(e => {\n    console.error(e) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\napp.use(ctx => {\n  ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n\n  return new Promise((resolve, reject) => {\n    ctx.res.on('close', resolve)\n    ctx.res.on('finish', resolve)\n    nuxt.render(ctx.req, ctx.res, promise => {\n      // nuxt.render passes a rejected promise into callback on error.\n      promise.then(resolve).catch(reject)\n    })\n  })\n})\n\n\napp.listen(port, host)\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}